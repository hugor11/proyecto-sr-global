<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cotizador MSI Stripe (MX)</title>
  <style>
    :root{
      --bg:#0b1020;--card:#131a2a;--muted:#8ea3b7;--text:#e8eef6;--accent:#4f8cff;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;
      --ring: 0 0 0 3px rgba(79,140,255,.35)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,Segoe UI,system-ui,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1020,#0f1a33 40%,#0b1020);color:var(--text)}
    .wrap{max-width:1000px;margin:32px auto;padding:0 16px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
    header h1{font-size:22px;margin:0;font-weight:700;letter-spacing:.2px}
    header .tag{background:rgba(79,140,255,.15);color:#cfe0ff;border:1px solid rgba(79,140,255,.3);padding:6px 10px;border-radius:999px;font-size:12px}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:880px){.grid{grid-template-columns: 1.1fr .9fr}}

    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px 16px 18px;box-shadow:0 10px 25px rgba(0,0,0,.25)}
    .card h2{font-size:16px;margin:2px 0 12px 0;font-weight:700}

    .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .controls .wide{grid-column:1/-1}

    label{display:block;font-size:12px;color:var(--muted);margin:2px 0 6px}
    .input{display:flex;align-items:center;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:12px;overflow:hidden}
    .input input, .input select{width:100%;background:transparent;border:0;color:var(--text);padding:12px 12px;font-size:16px;outline:none}
    .input input:focus, .input select:focus{box-shadow:var(--ring)}

    .tabs{display:flex;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:4px}
    .tab{flex:1;text-align:center;padding:10px 8px;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;color:var(--muted)}
    .tab.active{background:var(--accent);color:white}

    .rows{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
    .rows .full{grid-column:1/-1}

    .result{display:flex;align-items:center;justify-content:space-between;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.35);border-radius:14px;padding:14px 16px;margin-top:10px}
    .result h3{margin:0;font-size:16px}
    .result .num{font-size:22px;font-weight:800}

    .muted{color:var(--muted);font-size:12.5px}
    .fine{font-size:13px}
    .hl{color:#cfe0ff}

    .breakdown{margin-top:14px;border-top:1px dashed rgba(255,255,255,.12);padding-top:10px;font-size:14px;display:grid;gap:6px}
    .row{display:flex;align-items:center;justify-content:space-between}

    .note{margin-top:14px;font-size:12px;color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.15);font-size:12px;margin-right:6px}
    .footer{margin-top:18px;display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
    button:focus{box-shadow:var(--ring)}
    button.primary{background:var(--accent);border-color:rgba(79,140,255,.7);color:white}
    .danger{color:#ffd0d0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Cotizador MSI Stripe (México)</h1>
      <span class="tag">Cálculo instantáneo · 100% local</span>
    </header>

    <div class="grid">
      <!-- Panel izquierdo: configuración -->
      <section class="card">
        <h2>Parámetros</h2>
        <div class="controls">
          <div>
            <label>Plazo</label>
            <div class="input">
              <select id="plazo">
                <option value="0">Pago único (sin MSI)</option>
                <option value="3">3 meses</option>
                <option value="6" selected>6 meses</option>
                <option value="9">9 meses</option>
                <option value="12">12 meses</option>
                <option value="18">18 meses</option>
                <option value="24">24 meses</option>
              </select>
            </div>
          </div>
          <div>
            <label>Comisión Stripe estándar (%)</label>
            <div class="input"><input id="pctBase" type="number" step="0.01" value="3.6" /></div>
          </div>
          <div>
            <label>Comisión fija por transacción (MXN)</label>
            <div class="input"><input id="fijo" type="number" step="0.01" value="3" /></div>
          </div>
          <div>
            <label>Adicional por MSI (%)</label>
            <div class="input"><input id="pctMsi" type="number" step="0.01" value="7.5" /></div>
          </div>
          <div class="wide muted fine">Los % de MSI se llenan automáticamente según el plazo, pero puedes ajustarlos si tu cuenta maneja otros valores.</div>
        </div>
      </section>

      <!-- Panel derecho: modo de cálculo -->
      <section class="card">
        <h2>Calcular</h2>
        <div class="tabs" role="tablist">
          <div id="tabCobrar" class="tab active" role="tab" aria-selected="true">1) Pongo lo que <b>cobro</b> y veo lo que <b>recibo</b></div>
          <div id="tabRecibir" class="tab" role="tab" aria-selected="false">2) Pongo lo que <b>quiero recibir</b> y me dice cuánto <b>cobrar</b></div>
        </div>

        <div id="paneCobrar" class="rows" aria-live="polite">
          <div class="full">
            <label>Monto a cobrar al cliente (MXN)</label>
            <div class="input"><input id="montoCobrar" type="number" step="0.01" value="10000" /></div>
          </div>
          <div class="full result">
            <h3>Recibes neto</h3>
            <div class="num" id="netoRecibes">$—</div>
          </div>
          <div class="full breakdown">
            <div class="row"><span>Comisión estándar Stripe</span><strong id="comisionBase">$—</strong></div>
            <div class="row"><span>Comisión adicional por MSI</span><strong id="comisionMsi">$—</strong></div>
            <div class="row"><span>Total comisiones</span><strong id="totalComisiones">$—</strong></div>
            <div class="row"><span>Pago mensual del cliente</span><strong id="pagoMensual">$—</strong></div>
          </div>
        </div>

        <div id="paneRecibir" class="rows" style="display:none" aria-live="polite">
          <div class="full">
            <label>Neto que deseas recibir (MXN)</label>
            <div class="input"><input id="netoDeseado" type="number" step="0.01" value="8887" /></div>
          </div>
          <div class="full result">
            <h3>Debes cobrar</h3>
            <div class="num" id="debesCobrar">$—</div>
          </div>
          <div class="full breakdown">
            <div class="row"><span>Monto bruto a cobrar</span><strong id="brutoCobrar">$—</strong></div>
            <div class="row"><span>Comisión estándar Stripe</span><strong id="revComisionBase">$—</strong></div>
            <div class="row"><span>Comisión adicional por MSI</span><strong id="revComisionMsi">$—</strong></div>
            <div class="row"><span>Total comisiones</span><strong id="revTotalComisiones">$—</strong></div>
            <div class="row"><span>Pago mensual del cliente</span><strong id="revPagoMensual">$—</strong></div>
          </div>
        </div>

        <div class="footer">
          <span class="pill">MXN</span>
          <span class="pill">Stripe MX</span>
          <span class="pill">MSI</span>
          <button id="btnRedondear" class="primary" type="button">Redondear al peso hacia arriba</button>
          <button id="btnReset" type="button">Restablecer valores</button>
        </div>
        <div class="note">Aviso: Esto es una guía. Las comisiones reales pueden variar por cuenta, rubros o promociones bancarias. Verifica en tu Dashboard de Stripe.</div>
      </section>
    </div>
  </div>

  <script>
    // Tabla de % adicionales por MSI (valores de referencia provistos)
    const MSI_MAP = {0: 0, 3: 5, 6: 7.5, 9: 10, 12: 12.5, 18: 17.5, 24: 22.5};

    // Utilidades
    const $ = (sel)=>document.querySelector(sel);
    const fmt = (n)=> isFinite(n) ? n.toLocaleString('es-MX',{style:'currency',currency:'MXN'}) : '—';
    const num = (el)=> parseFloat(el.value || '0');

    // Elements
    const selPlazo = $('#plazo');
    const inputPctBase = $('#pctBase');
    const inputFijo = $('#fijo');
    const inputPctMsi = $('#pctMsi');

    const tabCobrar = $('#tabCobrar');
    const tabRecibir = $('#tabRecibir');
    const paneCobrar = $('#paneCobrar');
    const paneRecibir = $('#paneRecibir');

    const montoCobrar = $('#montoCobrar');
    const netoRecibes = $('#netoRecibes');
    const comisionBase = $('#comisionBase');
    const comisionMsi = $('#comisionMsi');
    const totalComisiones = $('#totalComisiones');
    const pagoMensual = $('#pagoMensual');

    const netoDeseado = $('#netoDeseado');
    const debesCobrar = $('#debesCobrar');
    const brutoCobrar = $('#brutoCobrar');
    const revComisionBase = $('#revComisionBase');
    const revComisionMsi = $('#revComisionMsi');
    const revTotalComisiones = $('#revTotalComisiones');
    const revPagoMensual = $('#revPagoMensual');

    const btnRedondear = $('#btnRedondear');
    const btnReset = $('#btnReset');

    // Actualiza % MSI cuando cambia el plazo
    function syncMsiPercent(){
      const plazo = parseInt(selPlazo.value,10);
      const pct = MSI_MAP[plazo] ?? 0;
      inputPctMsi.value = pct.toString();
    }

    function calcularDesdeCobro(){
      const bruto = num(montoCobrar);
      const pctBase = num(inputPctBase)/100;
      const fijo = num(inputFijo);
      const pctMsi = num(inputPctMsi)/100;

      const comBase = bruto * pctBase + fijo;
      const comMsi  = bruto * pctMsi;
      const total   = comBase + comMsi;
      const neto    = bruto - total;
      const meses   = parseInt(selPlazo.value,10) || 1;
      const mensual = meses>0 ? bruto/meses : bruto;

      netoRecibes.textContent = fmt(neto);
      comisionBase.textContent = fmt(comBase);
      comisionMsi.textContent = fmt(comMsi);
      totalComisiones.textContent = fmt(total);
      pagoMensual.textContent = meses ? fmt(mensual) + ` / ${meses} meses` : '—';
    }

    function calcularDesdeNeto(){
      const neto = num(netoDeseado);
      const pctBase = num(inputPctBase)/100;
      const fijo = num(inputFijo);
      const pctMsi = num(inputPctMsi)/100;

      const factor = 1 - pctBase - pctMsi;
      if (factor <= 0){
        debesCobrar.textContent = 'Imposible con % actuales';
        brutoCobrar.textContent = '—';
        revComisionBase.textContent = '—';
        revComisionMsi.textContent = '—';
        revTotalComisiones.textContent = '—';
        revPagoMensual.textContent = '—';
        return;
      }
      const bruto = (neto + fijo) / factor;
      const comBase = bruto * pctBase + fijo;
      const comMsi  = bruto * pctMsi;
      const total   = comBase + comMsi;
      const meses   = parseInt(selPlazo.value,10) || 1;
      const mensual = meses>0 ? bruto/meses : bruto;

      debesCobrar.textContent = fmt(bruto);
      brutoCobrar.textContent = fmt(bruto);
      revComisionBase.textContent = fmt(comBase);
      revComisionMsi.textContent = fmt(comMsi);
      revTotalComisiones.textContent = fmt(total);
      revPagoMensual.textContent = meses ? fmt(mensual) + ` / ${meses} meses` : '—';
    }

    function redondearArribaPeso(){
      if (paneCobrar.style.display !== 'none'){
        const v = num(montoCobrar);
        montoCobrar.value = Math.ceil(v).toString();
        calcularDesdeCobro();
      } else {
        const v = num(netoDeseado);
        netoDeseado.value = Math.ceil(v).toString();
        calcularDesdeNeto();
      }
    }

    function setTab(which){
      const isCobrar = which === 'cobrar';
      tabCobrar.classList.toggle('active', isCobrar);
      tabRecibir.classList.toggle('active', !isCobrar);
      paneCobrar.style.display  = isCobrar ? '' : 'none';
      paneRecibir.style.display = isCobrar ? 'none' : '';
      (isCobrar?calcularDesdeCobro:calcularDesdeNeto)();
    }

    function resetAll(){
      selPlazo.value = '6';
      inputPctBase.value = '3.6';
      inputFijo.value = '3';
      syncMsiPercent();
      montoCobrar.value = '10000';
      netoDeseado.value = '8887';
      setTab('cobrar');
    }

    // Event listeners
    selPlazo.addEventListener('change', ()=>{ syncMsiPercent(); calcularDesdeCobro(); calcularDesdeNeto(); });
    inputPctBase.addEventListener('input', ()=>{ calcularDesdeCobro(); calcularDesdeNeto(); });
    inputFijo.addEventListener('input', ()=>{ calcularDesdeCobro(); calcularDesdeNeto(); });
    inputPctMsi.addEventListener('input', ()=>{ calcularDesdeCobro(); calcularDesdeNeto(); });

    montoCobrar.addEventListener('input', calcularDesdeCobro);
    netoDeseado.addEventListener('input', calcularDesdeNeto);

    tabCobrar.addEventListener('click', ()=>setTab('cobrar'));
    tabRecibir.addEventListener('click', ()=>setTab('recibir'));

    btnRedondear.addEventListener('click', redondearArribaPeso);
    btnReset.addEventListener('click', resetAll);

    // Init
    syncMsiPercent();
    calcularDesdeCobro();
    calcularDesdeNeto();
  </script>
</body>
</html>
