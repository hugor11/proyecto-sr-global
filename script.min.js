function startApp(){if(!window.__appStarted){window.__appStarted=!0,initFancybox(),initMobileMenu(),addScrollEffects(),initModals(),watchCarouselVisibility();try{initSwiper()}catch{}initZohoFormIntegration(),initGAInteractions()}}function safeStartApp(){if("complete"!==document.readyState&&"interactive"!==document.readyState)return console.log("DOM not ready, waiting..."),!1;if("function"!=typeof document.querySelector)return console.warn("Basic DOM methods not available"),!1;try{return startApp(),!0}catch(e){return console.error("Error starting app:",e),setTimeout(function(){try{startApp()}catch(e){console.error("Second attempt failed:",e)}},1e3),!1}}!function(){"use strict";function e(){try{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}catch(e){console.warn("Error setting VH property:",e)}}Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches&&t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),e(),window.addEventListener("resize",e,{passive:!0}),window.addEventListener("orientationchange",function(){setTimeout(e,200)},{passive:!0}),"ontouchstart"in window&&document.documentElement.classList.add("touch-device"),window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&(document.documentElement.style.webkitOverflowScrolling="touch"),console.log("iOS/Safari polyfills and fixes loaded")}(),window.__appStarted=window.__appStarted||!1,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",safeStartApp,{once:!0}):setTimeout(safeStartApp,0),window.addEventListener("load",function(){window.__appStarted||setTimeout(safeStartApp,200)},{once:!0}),window.addEventListener("pageshow",function(e){console.log("pageshow event fired, persisted:",e.persisted),e.persisted?(console.log("Page restored from bfcache, reinitializing mobile menu"),window.__appStarted=!1,setTimeout(function(){safeStartApp()},100)):window.__appStarted||setTimeout(safeStartApp,100)}),setTimeout(function(){window.__appStarted||(console.warn("Forcing app start after timeout"),safeStartApp())},3e3);let promotionsSwiper=null;function initSwiper(){ensurePromotionsSwiper(!1)}let __swiperWaitTimer=null;function ensurePromotionsSwiper(e=!1){const t=document.querySelector("#promotions-carousel");if(void 0===window.Swiper)return void(__swiperWaitTimer||(__swiperWaitTimer=setInterval(()=>{void 0!==window.Swiper&&(clearInterval(__swiperWaitTimer),__swiperWaitTimer=null,ensurePromotionsSwiper(!0))},150)));if(!t)return;const o=!(!t.offsetParent&&!t.getClientRects().length);if(promotionsSwiper)try{promotionsSwiper.update(),console.log("üîÑ Swiper actualizado")}catch{}else{if(!o&&!e)return;try{promotionsSwiper=new Swiper("#promotions-carousel",{slidesPerView:1,spaceBetween:20,pagination:{el:"#promotions-carousel .swiper-pagination",clickable:!0},navigation:{nextEl:"#promotions-carousel .swiper-button-next",prevEl:"#promotions-carousel .swiper-button-prev"},breakpoints:{640:{slidesPerView:2,spaceBetween:20},1024:{slidesPerView:3,spaceBetween:30}},loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1},observer:!0,observeParents:!0}),setTimeout(()=>promotionsSwiper&&promotionsSwiper.update(),100),console.log("‚úÖ Swiper inicializado")}catch(e){console.error("‚ùå Error al inicializar Swiper:",e)}}}function watchCarouselVisibility(){const e=document.querySelector("#promotions-carousel");if(!("IntersectionObserver"in window)||!e)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(ensurePromotionsSwiper(!0),t.disconnect())})},{threshold:.1});t.observe(e)}function initFancybox(){if(void 0!==window.Fancybox)try{Fancybox.bind("[data-fancybox]",{animated:!0,showClass:"fancybox-zoomIn",hideClass:"fancybox-zoomOut"})}catch{}}function initZohoFormIntegration(){const e=document.getElementById("zoho-form-iframe");if(!e)return;let t=1e3;window.addEventListener("message",o=>{const n=o.data;if(n&&"object"==typeof n&&("zohoForm:resize"===n.type&&n.height&&(o=>{const n=Math.max(600,Math.min(3e3,Number(o)||t));t=n,e.style.height=n+"px"})(n.height),"zohoForm:submitted"===n.type))try{"function"==typeof gtag&&gtag("event","generate_lead",{method:"zoho_form",event_category:"lead",event_label:"contact_form",value:1})}catch{}});const o=setInterval(()=>{try{e.contentWindow&&e.contentWindow.postMessage({type:"parent:requestHeight"},"*")}catch{}},1500),n=new MutationObserver(()=>{document.body.contains(e)||(clearInterval(o),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})}function initGAInteractions(){const e=(e,t)=>{try{"function"==typeof gtag&&gtag("event",e,t||{})}catch{}};document.addEventListener("click",t=>{const o=t.target&&t.target.closest?t.target.closest("a"):null;if(!o)return;const n=(o.getAttribute("href")||"").trim();if(!n)return;const i={page_path:location.pathname+location.search,link_url:n};if(/wa\.me|api\.whatsapp\.com|whatsapp:\/\//i.test(n))return void e("contact",{method:"whatsapp",...i});if(n.startsWith("mailto:"))return void e("contact",{method:"email",...i});if(n.startsWith("tel:"))return void e("contact",{method:"phone",...i});const r=o.matches('[data-lang-key="navContactBtn"]'),s=/contact\.html(\?|#|$)/i.test(n);(r||s)&&e("contact",{method:r?"contact_button":"contact_page_link",...i})},!0)}function addScrollEffects(){window.addEventListener("scroll",function(){const e=document.getElementById("navbar");window.scrollY>50?(e.classList.add("py-2"),e.classList.remove("py-3")):(e.classList.add("py-3"),e.classList.remove("py-2"))});const e=document.querySelectorAll(".destination-circle, .service-card"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)",t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.5s ease, transform 0.5s ease",t.observe(e)})}function initModals(){document.querySelectorAll(".open-modal").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-modal");document.getElementById(e).classList.remove("hidden"),document.body.style.overflow="hidden"})}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){this.closest('[id$="-modal"]').classList.add("hidden"),document.body.style.overflow=""})}),document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.addEventListener("click",function(e){e.target===this&&(this.classList.add("hidden"),document.body.style.overflow="")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.classList.contains("hidden")||(e.classList.add("hidden"),document.body.style.overflow="")})})}function initMobileMenu(){const e=document.getElementById("menu-toggle"),t=document.getElementById("mobile-menu");if(!e||!t)return void console.warn("Mobile menu elements not found");console.log("Initializing mobile menu (refactored version)"),console.log("Menu toggle element:",e),console.log("Menu toggle computed style:",window.getComputedStyle(e)),console.log("Menu toggle z-index:",window.getComputedStyle(e).zIndex),console.log("User agent:",navigator.userAgent),console.log("Is likely iOS:",/iPad|iPhone|iPod/.test(navigator.userAgent));let o=!1;function n(){o=!1,t.classList.add("hidden"),t.style.display="none",e.querySelector("i").className="fas fa-bars text-2xl",e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Abrir men√∫"),console.log("Menu closed")}function i(i){console.log("Menu toggle triggered by:",i.type,"on",navigator.userAgent.includes("iPhone")?"iOS":"other"),o?n():(o=!0,t.classList.remove("hidden"),t.style.display="block",e.querySelector("i").className="fas fa-times text-2xl",e.setAttribute("aria-expanded","true"),e.setAttribute("aria-label","Cerrar men√∫"),console.log("Menu opened")),console.log("Menu toggled, isOpen:",o)}e.addEventListener("click",i),/iPad|iPhone|iPod/.test(navigator.userAgent)&&(console.log("iOS detected, adding touchstart fallback"),e.addEventListener("touchstart",function(e){setTimeout(function(){e.defaultPrevented||(console.log("touchstart fallback triggered"),i(e))},50)},{passive:!0})),document.addEventListener("click",function(i){if(!o)return;const r=t.contains(i.target),s=e.contains(i.target);r||s||(n(),console.log("Menu closed (clicked outside)"))});let r;t.querySelectorAll("a").forEach(e=>{e.addEventListener("click",function(){console.log("Menu link clicked, navigating to:",this.href),n()})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&o&&(n(),console.log("Menu closed (ESC key)"))}),window.addEventListener("resize",function(){clearTimeout(r),r=setTimeout(function(){window.innerWidth>=768&&o&&(n(),console.log("Menu closed (window resized to desktop)"))},100)}),e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls","mobile-menu"),e.setAttribute("aria-label","Abrir men√∫"),setTimeout(function(){console.log("Post-init verification:"),console.log("Menu toggle clickable?",!e.style.pointerEvents||"none"!==e.style.pointerEvents),console.log("Menu toggle visible?","none"!==window.getComputedStyle(e).display),console.log("Menu toggle z-index:",window.getComputedStyle(e).zIndex),/iPad|iPhone|iPod/.test(navigator.userAgent)&&(e.style.pointerEvents="auto",e.style.zIndex="10001",e.style.position="relative",console.log("iOS critical styles forced on menu toggle"))},500),console.log("Mobile menu initialized successfully (refactored)")}