let lastToggleTime=0;const DEBOUNCE_MS=300;function setVH(){try{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),console.log("VH updated:",e,"px")}catch(e){console.warn("Error setting VH property:",e)}}function startApp(){if(window.__appStarted)return;window.__appStarted=!0,console.log("ðŸš€ Iniciando aplicaciÃ³n...");const e=document.querySelector("#menu-toggle");e&&!e._menuBound&&(console.log("âš ï¸ MenÃº no inicializado, ejecutando attachMenuListeners..."),attachMenuListeners()),initFancybox(),addScrollEffects(),initModals(),watchCarouselVisibility();try{initSwiper()}catch{}initZohoFormIntegration(),initGAInteractions(),console.log("âœ… AplicaciÃ³n iniciada exitosamente")}function safeStartApp(){if("complete"!==document.readyState&&"interactive"!==document.readyState)return console.log("DOM not ready, waiting..."),!1;if("function"!=typeof document.querySelector)return console.warn("Basic DOM methods not available"),!1;try{return startApp(),!0}catch(e){return console.error("Error starting app:",e),setTimeout(function(){try{startApp()}catch(e){console.error("Second attempt failed:",e)}},1e3),!1}}function attachMenuListeners(){console.log("ðŸ” Ejecutando attachMenuListeners...");const e=document.querySelectorAll("#menu-toggle, .hamburger, [data-menu-toggle]");console.log("ðŸ” Botones encontrados:",e.length),0!==e.length?e.forEach((e,t)=>{if(console.log(`ðŸ” Procesando botÃ³n ${t+1}:`,e),e._menuBound)return void console.log(`âš ï¸ BotÃ³n ${t+1} ya tiene listeners, saltando`);e._menuBound=!0;const o=t=>{const o=Date.now();if(o-lastToggleTime<300)return void console.log("â­ï¸ Toggle ignorado (debounce)");lastToggleTime=o,console.log("ðŸŽ¯ Toggle menu disparado por:",t.type,"en botÃ³n:",e),t?.preventDefault?.();const n=document.querySelector("#mobile-menu");if(!n)return void console.error("âŒ No se encontrÃ³ #mobile-menu");const i="true"===e.getAttribute("aria-expanded"),r=!i;console.log("ðŸ“± Cambiando estado del menÃº de",i,"a",r),e.setAttribute("aria-expanded",String(r)),r?(n.classList.remove("hidden"),n.style.display="block",e.querySelector("i").className="fas fa-times text-2xl",e.setAttribute("aria-label","Cerrar menÃº"),document.body.classList.add("no-scroll"),console.log("âœ… MenÃº abierto exitosamente")):(n.classList.add("hidden"),n.style.display="none",e.querySelector("i").className="fas fa-bars text-2xl",e.setAttribute("aria-label","Abrir menÃº"),document.body.classList.remove("no-scroll"),console.log("âœ… MenÃº cerrado exitosamente"))};e.addEventListener("click",o),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(e))}),e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls","mobile-menu"),e.setAttribute("aria-label","Abrir menÃº"),console.log(`âœ… Listeners agregados exitosamente al botÃ³n ${t+1}`)}):console.error("âŒ NO se encontrÃ³ ningÃºn botÃ³n de menÃº hamburguesa")}function initSwiper(){ensurePromotionsSwiper(!1)}!function(){"use strict";function e(){try{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),console.log("VH updated:",e,"px")}catch(e){console.warn("Error setting VH property:",e)}}Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches&&t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),e(),window.addEventListener("resize",e,{passive:!0}),window.addEventListener("orientationchange",function(){setTimeout(e,100)},{passive:!0}),"ontouchstart"in window&&document.documentElement.classList.add("touch-device"),window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&(document.documentElement.style.webkitOverflowScrolling="touch"),window.debugMenuPosition=function(){const e=document.querySelector("#menu-toggle");if(!e)return console.error("Menu toggle not found");const t=e.getBoundingClientRect(),o=t.left+t.width/2,n=t.top+t.height/2,i=document.elementFromPoint(o,n);console.log("=== DIAGNÃ“STICO MENÃš ==="),console.log("BotÃ³n:",e),console.log("RectÃ¡ngulo:",t),console.log("Centro del botÃ³n:",{x:o,y:n}),console.log("Elemento superior:",i),console.log("Â¿Es el botÃ³n?",i===e),console.log("Z-index del botÃ³n:",getComputedStyle(e).zIndex),console.log("Z-index del elemento superior:",i?getComputedStyle(i).zIndex:"N/A"),i!==e&&(console.warn("âš ï¸ PROBLEMA: Hay algo tapando el botÃ³n del menÃº"),console.log("Elemento que tapa:",i),console.log("Clases del elemento:",i?.className))},console.log("iOS/Safari polyfills and fixes loaded")}(),window.__appStarted=window.__appStarted||!1,console.log("ðŸ” Script cargado. Estado DOM:",document.readyState),"loading"===document.readyState?(console.log("ðŸ”„ DOM cargando, esperando DOMContentLoaded..."),document.addEventListener("DOMContentLoaded",function(){console.log("âœ… DOMContentLoaded disparado"),setVH(),attachMenuListeners(),safeStartApp()},{once:!0})):(console.log("âœ… DOM ya listo, inicializando inmediatamente"),setTimeout(function(){setVH(),attachMenuListeners(),safeStartApp()},0)),window.addEventListener("load",function(){console.log("ðŸ”„ Load event disparado"),window.__appStarted||(console.log("âš ï¸ App no habÃ­a iniciado, iniciando ahora..."),setTimeout(function(){setVH(),attachMenuListeners(),safeStartApp()},200))},{once:!0}),window.addEventListener("pageshow",function(e){console.log("ðŸ”„ pageshow event fired, persisted:",e.persisted),e.persisted?(console.log("ðŸ”„ Page restored from bfcache, reinitializing..."),document.querySelectorAll("#menu-toggle, .hamburger, [data-menu-toggle]").forEach(e=>{e._menuBound=!1,console.log("ðŸ§¹ Flag _menuBound limpiado en botÃ³n:",e)}),setTimeout(function(){setVH(),attachMenuListeners(),document.querySelectorAll(".overlay, .hero::before, .banner-overlay").forEach(e=>{const t=getComputedStyle(e);"0"!==t.opacity&&"hidden"!==t.visibility||(e.style.pointerEvents="none")})},100)):(console.log("ðŸ”„ Primera carga de pÃ¡gina"),window.__appStarted||setTimeout(function(){setVH(),attachMenuListeners(),safeStartApp()},100))}),setTimeout(function(){const e=document.querySelector("#menu-toggle");e&&e._menuBound||(console.warn("ðŸš¨ FORCING menu initialization after timeout"),console.log("ðŸ” Estado del botÃ³n:",e),console.log("ðŸ” Â¿Tiene listeners?",e?._menuBound),setVH(),attachMenuListeners(),window.__appStarted||safeStartApp())},3e3);let __swiperWaitTimer=null;function ensurePromotionsSwiper(e=!1){const t=document.querySelector("#promotions-carousel");if(void 0===window.Swiper)return void(__swiperWaitTimer||(__swiperWaitTimer=setInterval(()=>{void 0!==window.Swiper&&(clearInterval(__swiperWaitTimer),__swiperWaitTimer=null,ensurePromotionsSwiper(!0))},150)));if(!t)return;if(window.SR&&window.SR.promotionsSwiper){try{window.SR.promotionsSwiper.destroy(!0,!0)}catch(e){console.warn("Error destroying Swiper:",e)}window.SR.promotionsSwiper=null}const o=t.querySelector(".swiper-pagination");if(o&&(o.innerHTML=""),null===t.offsetParent){console.warn("Swiper container not visible yet, deferring init");const e=new IntersectionObserver(t=>{t[0].isIntersecting&&(e.disconnect(),ensurePromotionsSwiper(!0))});return void e.observe(t)}window.SR.promotionsSwiper=new Swiper("#promotions-carousel",{slidesPerView:1,spaceBetween:20,pagination:{el:"#promotions-carousel .swiper-pagination",clickable:!0,dynamicBullets:!1,renderBullet:function(e,t){return`<span class="${t}" role="button" aria-label="Ir a slide ${e+1}"></span>`}},navigation:{nextEl:"#promotions-carousel .swiper-button-next",prevEl:"#promotions-carousel .swiper-button-prev"},breakpoints:{640:{slidesPerView:2,spaceBetween:20},1024:{slidesPerView:3,spaceBetween:30}},loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},observer:!0,observeParents:!0,observeSlideChildren:!0,on:{init:function(){console.log("âœ… Swiper inicializado con",this.slides.length,"slides"),this.pagination.render(),this.pagination.update()},slideChange:function(){console.log("ðŸ“ Slide activo:",this.activeIndex)}}}),setTimeout(()=>{window.SR.promotionsSwiper&&(window.SR.promotionsSwiper.update(),window.SR.promotionsSwiper.pagination.render(),window.SR.promotionsSwiper.pagination.update())},100)}function watchCarouselVisibility(){const e=document.querySelector("#promotions-carousel");if(!("IntersectionObserver"in window)||!e)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(ensurePromotionsSwiper(!0),t.disconnect())})},{threshold:.1});t.observe(e)}function initFancybox(){if(void 0!==window.Fancybox)try{Fancybox.bind("[data-fancybox]",{animated:!0,showClass:"fancybox-zoomIn",hideClass:"fancybox-zoomOut"})}catch{}}function initZohoFormIntegration(){const e=document.getElementById("zoho-form-iframe");if(!e)return;let t=1e3;window.addEventListener("message",o=>{const n=o.data;if(n&&"object"==typeof n&&("zohoForm:resize"===n.type&&n.height&&(o=>{const n=Math.max(600,Math.min(3e3,Number(o)||t));t=n,e.style.height=n+"px"})(n.height),"zohoForm:submitted"===n.type))try{"function"==typeof gtag&&gtag("event","generate_lead",{method:"zoho_form",event_category:"lead",event_label:"contact_form",value:1})}catch{}});const o=setInterval(()=>{try{e.contentWindow&&e.contentWindow.postMessage({type:"parent:requestHeight"},"*")}catch{}},1500),n=new MutationObserver(()=>{document.body.contains(e)||(clearInterval(o),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})}function initGAInteractions(){const e=(e,t)=>{try{"function"==typeof gtag&&gtag("event",e,t||{})}catch{}};document.addEventListener("click",t=>{const o=t.target&&t.target.closest?t.target.closest("a"):null;if(!o)return;const n=(o.getAttribute("href")||"").trim();if(!n)return;const i={page_path:location.pathname+location.search,link_url:n};if(/wa\.me|api\.whatsapp\.com|whatsapp:\/\//i.test(n))return void e("contact",{method:"whatsapp",...i});if(n.startsWith("mailto:"))return void e("contact",{method:"email",...i});if(n.startsWith("tel:"))return void e("contact",{method:"phone",...i});const r=o.matches('[data-lang-key="navContactBtn"]'),s=/contact\.html(\?|#|$)/i.test(n);(r||s)&&e("contact",{method:r?"contact_button":"contact_page_link",...i})},!0)}function addScrollEffects(){window.addEventListener("scroll",function(){const e=document.getElementById("navbar");window.scrollY>50?(e.classList.add("py-2"),e.classList.remove("py-3")):(e.classList.add("py-3"),e.classList.remove("py-2"))});const e=document.querySelectorAll(".destination-circle, .service-card"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)",t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.5s ease, transform 0.5s ease",t.observe(e)})}function initModals(){document.querySelectorAll(".open-modal").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-modal");document.getElementById(e).classList.remove("hidden"),document.body.style.overflow="hidden"})}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){this.closest('[id$="-modal"]').classList.add("hidden"),document.body.style.overflow=""})}),document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.addEventListener("click",function(e){e.target===this&&(this.classList.add("hidden"),document.body.style.overflow="")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.classList.contains("hidden")||(e.classList.add("hidden"),document.body.style.overflow="")})})}window.SR=window.SR||{},window.SR.__mainLoaded?console.warn("[SR] main bundle already loaded - skipping duplicate execution"):(window.SR.__mainLoaded=!0,window.SR.initPromotionsSwiper=window.SR.initPromotionsSwiper||function(){},window.SR.destroyPromotionsSwiper=window.SR.destroyPromotionsSwiper||function(){},window.initPromotionsSwiper=window.initPromotionsSwiper||function(){return window.SR.initPromotionsSwiper?.()},window.destroyPromotionsSwiper=window.destroyPromotionsSwiper||function(){return window.SR.destroyPromotionsSwiper?.()});