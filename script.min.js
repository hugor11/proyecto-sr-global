let lastToggleTime=0;const DEBOUNCE_MS=300;function setVH(){try{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),console.log("VH updated:",e,"px")}catch(e){console.warn("Error setting VH property:",e)}}function startApp(){if(!window.__appStarted){window.__appStarted=!0,console.log("🚀 Iniciando aplicación..."),initFancybox(),addScrollEffects(),initModals(),watchCarouselVisibility();try{initSwiper()}catch{}initZohoFormIntegration(),initGAInteractions(),console.log("✅ Aplicación iniciada exitosamente")}}function safeStartApp(){if("complete"!==document.readyState&&"interactive"!==document.readyState)return console.log("DOM not ready, waiting..."),!1;if("function"!=typeof document.querySelector)return console.warn("Basic DOM methods not available"),!1;try{return startApp(),!0}catch(e){return console.error("Error starting app:",e),setTimeout(function(){try{startApp()}catch(e){console.error("Second attempt failed:",e)}},1e3),!1}}!function(){"use strict";function e(){try{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),console.log("VH updated:",e,"px")}catch(e){console.warn("Error setting VH property:",e)}}Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches&&t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),e(),window.addEventListener("resize",e,{passive:!0}),window.addEventListener("orientationchange",function(){setTimeout(e,100)},{passive:!0}),"ontouchstart"in window&&document.documentElement.classList.add("touch-device"),window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&(document.documentElement.style.webkitOverflowScrolling="touch"),window.debugMenuPosition=function(){const e=document.querySelector("#menu-toggle");if(!e)return console.error("Menu toggle not found");const t=e.getBoundingClientRect(),o=t.left+t.width/2,n=t.top+t.height/2,a=document.elementFromPoint(o,n);console.log("=== DIAGNÓSTICO MENÚ ==="),console.log("Botón:",e),console.log("Rectángulo:",t),console.log("Centro del botón:",{x:o,y:n}),console.log("Elemento superior:",a),console.log("¿Es el botón?",a===e),console.log("Z-index del botón:",getComputedStyle(e).zIndex),console.log("Z-index del elemento superior:",a?getComputedStyle(a).zIndex:"N/A"),a!==e&&(console.warn("⚠️ PROBLEMA: Hay algo tapando el botón del menú"),console.log("Elemento que tapa:",a),console.log("Clases del elemento:",a?.className))},console.log("iOS/Safari polyfills and fixes loaded")}(),window.__appStarted=window.__appStarted||!1,console.log("🔍 Script cargado. Estado DOM:",document.readyState),(()=>{if(window.SR=window.SR||{},window.SR.__mainLoaded)return void console.warn("[SR] main bundle already loaded — skipping duplicate execution");let e;function t(e){const t=document.querySelector("[data-menu-toggle]"),o=document.querySelector("[data-menu-panel]")||document.getElementById("mobile-menu"),n=document.querySelector("[data-menu-overlay]");if(!t||!o)return;t.setAttribute("aria-expanded",String(e)),t.setAttribute("aria-label",e?"Cerrar menú":"Abrir menú"),o.hidden=!e,document.body.classList.toggle("overflow-hidden",e),document.body.classList.toggle("touch-none",e),n&&n.classList.toggle("hidden",!e);const a=t.querySelector("i");a&&(a.className=e?"fas fa-times text-2xl":"fas fa-bars text-2xl"),console.log(e?"✅ Menú abierto":"✅ Menú cerrado")}function o(){e&&e.abort(),e=new AbortController;const{signal:o}=e;document.addEventListener("click",e=>{const o=e.target.closest("[data-menu-toggle]"),n=e.target.closest("[data-menu-close]"),a=e.target.closest("[data-menu-overlay]"),i=e.target.closest("[data-menu-panel] a[href]");if(o){e.preventDefault(),e.stopPropagation();const n="true"===o.getAttribute("aria-expanded");console.log("🎯 Toggle por botón hamburguesa"),t(!n)}else n?(e.preventDefault(),e.stopPropagation(),console.log("🔴 Cerrando por botón X"),t(!1)):a?(e.preventDefault(),e.stopPropagation(),console.log("🔴 Cerrando por overlay"),t(!1)):i&&(console.log("🔗 Cerrando por link"),t(!1))},{capture:!0,signal:o}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.querySelector("[data-menu-toggle]");"true"===e?.getAttribute("aria-expanded")&&(console.log("🔴 Cerrando con Escape"),t(!1))}},{signal:o}),document.addEventListener("click",e=>{const o=document.querySelector("[data-menu-panel]"),n=document.querySelector("[data-menu-toggle]");if(!("true"===n?.getAttribute("aria-expanded")))return;o?.contains(e.target)||n?.contains(e.target)||e.target.closest("[data-menu-overlay]")||(console.log("🔴 Cerrando por clic fuera"),t(!1))},{capture:!0,signal:o})}function n(){if(void 0!==window.Fancybox)try{Fancybox.bind("[data-fancybox]",{animated:!0,showClass:"fancybox-zoomIn",hideClass:"fancybox-zoomOut"})}catch{}}function a(){const e=(e,t)=>{try{"function"==typeof gtag&&gtag("event",e,t||{})}catch{}};document.addEventListener("click",t=>{const o=t.target&&t.target.closest?t.target.closest("a"):null;if(!o)return;const n=(o.getAttribute("href")||"").trim();if(!n)return;const a={page_path:location.pathname+location.search,link_url:n};if(/wa\.me|api\.whatsapp\.com|whatsapp:\/\//i.test(n))return void e("contact",{method:"whatsapp",...a});if(n.startsWith("mailto:"))return void e("contact",{method:"email",...a});if(n.startsWith("tel:"))return void e("contact",{method:"phone",...a});const i=o.matches('[data-lang-key="navContactBtn"]'),r=/contact\.html(\?|#|$)/i.test(n);(i||r)&&e("contact",{method:i?"contact_button":"contact_page_link",...a})},!0)}function i(){window.addEventListener("scroll",function(){const e=document.getElementById("navbar");window.scrollY>50?(e.classList.add("py-2"),e.classList.remove("py-3")):(e.classList.add("py-3"),e.classList.remove("py-2"))});const e=document.querySelectorAll(".destination-circle, .service-card"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)",t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.5s ease, transform 0.5s ease",t.observe(e)})}function r(){document.querySelectorAll(".open-modal").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-modal");document.getElementById(e).classList.remove("hidden"),document.body.style.overflow="hidden"})}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){this.closest('[id$="-modal"]').classList.add("hidden"),document.body.style.overflow=""})}),document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.addEventListener("click",function(e){e.target===this&&(this.classList.add("hidden"),document.body.style.overflow="")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll('[id$="-modal"]').forEach(e=>{e.classList.contains("hidden")||(e.classList.add("hidden"),document.body.style.overflow="")})})}window.SR.__mainLoaded=!0,"loading"===document.readyState?(console.log("🔄 DOM cargando, esperando DOMContentLoaded..."),document.addEventListener("DOMContentLoaded",function(){console.log("✅ DOMContentLoaded disparado"),setVH(),o(),d()},{once:!0})):(console.log("✅ DOM ya listo, inicializando inmediatamente"),setTimeout(function(){setVH(),o(),d()},0)),window.addEventListener("load",function(){console.log("🔄 Load event disparado"),window.__appStarted||(console.log("⚠️ App no había iniciado, iniciando ahora..."),setTimeout(function(){setVH(),o(),d()},200))},{once:!0}),window.addEventListener("pageshow",function(e){console.log("🔄 pageshow event fired, persisted:",e.persisted),e.persisted?(console.log("🔄 Page restored from bfcache, reinitializing..."),setTimeout(function(){setVH(),o(),document.querySelectorAll(".overlay, .hero::before, .banner-overlay").forEach(e=>{const t=getComputedStyle(e);"0"!==t.opacity&&"hidden"!==t.visibility||(e.style.pointerEvents="none")})},100)):(console.log("🔄 Primera carga de página"),window.__appStarted||setTimeout(function(){setVH(),o(),d()},100))}),setTimeout(function(){window.__appStarted||(console.warn("🚨 FORCING app initialization after timeout"),setVH(),o(),d())},3e3);let c=null;function s(e=!1){const t=document.querySelector("#promotions-carousel");if(void 0===window.Swiper)return void(c||(c=setInterval(()=>{void 0!==window.Swiper&&(clearInterval(c),c=null,s(!0))},150)));if(!t)return;if(window.SR&&window.SR.promotionsSwiper){try{window.SR.promotionsSwiper.destroy(!0,!0)}catch(e){console.warn("Error destroying Swiper:",e)}window.SR.promotionsSwiper=null}const o=t.querySelector(".swiper-pagination");if(o&&(o.innerHTML=""),null===t.offsetParent){console.warn("Swiper container not visible yet, deferring init");const e=new IntersectionObserver(t=>{t[0].isIntersecting&&(e.disconnect(),s(!0))});return void e.observe(t)}try{window.SR.promotionsSwiper=new window.Swiper(t,{slidesPerView:1,spaceBetween:20,loop:!1,grabCursor:!0,pagination:{el:".swiper-pagination",clickable:!0,dynamicBullets:!0},breakpoints:{640:{slidesPerView:2},1024:{slidesPerView:3}},on:{init(){console.log("✅ Swiper inicializado correctamente"),this.pagination.render(),this.pagination.update()}}})}catch(e){console.error("Error initializing Swiper:",e)}}function l(){s(!1)}function r(){}function d(){window.__appStarted?console.log("🔄 App ya iniciada, saltando reinicialización"):(window.__appStarted=!0,console.log("🚀 Iniciando app..."),o(),l(),setVH(),n(),i(),"function"==typeof r&&r(),a(),console.log("✅ App iniciada correctamente"))}window.addEventListener("pageshow",e=>{e.persisted&&(console.log("🔄 pageshow con BFCache, reinicializando"),o(),l())}),window.addEventListener("pagehide",()=>{e?.abort(),t(!1)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();